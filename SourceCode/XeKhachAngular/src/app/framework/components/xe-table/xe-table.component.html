<ng-template #basicFormDirect let-basicFormDialog="dialogRef">
  <div class="basic-form-dialog">
    <xe-basic-form [ref]="basicFormDialog"
                   [onDelete]="deleteEntitySuccess"
                   [onSuccess]="submitEntitySuccess"
                   [formData]="tableData.formData">
      <ng-content select="[belowBasicFormHeader]"></ng-content>
    </xe-basic-form>
  </div>
</ng-template>
<!-- ########### END OF BASIC FORM ##############-->

<ng-template #deleteDirect let-deleteDialog="dialogRef">
  <div class="basic-form-dialog text-center">
    <nb-card>
      <nb-card-header>
        Cảnh báo xóa dữ liệu không hồi phục:
      </nb-card-header>
      <nb-card-body>
        <h3><span class="text-danger">{{selection.selected.length}} bản ghi</span> được chọn!</h3>
        <p>Sẽ bị xóa hoàn toàn, bạn chắc chứ...</p>
      </nb-card-body>
      <nb-card-footer class="text-center">
        <xe-btn type="back" (click)="deleteDialog.close()"></xe-btn>
        <xe-btn type="ok" (click)="deleteDialog.close(); deleteSelected()"></xe-btn>
      </nb-card-footer>
    </nb-card>
  </div>
</ng-template>
<!-- ########### END OF DELETE DIALOG ##############-->

<nb-card>
  <nb-card-body>
    <mat-form-field appearance="legacy">
      <mat-label>Gõ để tìm...</mat-label>
      <input matInput (keyup)="applyFilter($event)" placeholder="gõ..." #input>
    </mat-form-field>

    <div class="float-right">
      <xe-btn type="add" (click)="newDialog()" hideText></xe-btn>
      <xe-btn type="dangerDelete" [disabled]="!hasRowSelected" (click)="openDeleteDialog()" hideText></xe-btn>
    </div>

    <table mat-table matSort [dataSource]="dataSource">

      <!-- ------------- BASIC column ------------------->
      <ng-container *ngFor="let column of tableData.table.basicColumns" [matColumnDef]="column.name">
        <th mat-header-cell mat-sort-header *matHeaderCellDef class="{{column.hiddenClass}}">
          <lbl [key]="column.name"></lbl>
        </th>
        <td mat-cell *matCellDef="let element" (click)="editDialog(element)">
          <ng-container *ngTemplateOutlet="getColumn(column.type); context:{column: column, element:element}"></ng-container>
        </td>
      </ng-container>

      <!-- ------------- SELECT column ------------------->
      <ng-container matColumnDef="select">
        <th mat-header-cell *matHeaderCellDef>
          <nb-checkbox (change)="$event ? toggleSelectAll() : null"
                       [checked]="selection.hasValue() && isAllSelected()"
                       [indeterminate]="selection.hasValue() && !isAllSelected()">
          </nb-checkbox>
        </th>
        <td mat-cell *matCellDef="let row">
          <nb-checkbox (click)="$event.stopPropagation()"
                       (change)="$event ? selection.toggle(row) : null"
                       [checked]="selection.isSelected(row)">
          </nb-checkbox>
        </td>
      </ng-container>

      <!-- Row shown when there is no matching data. -->
      <tr class="mat-row" *matNoDataRow>
        <td class="mat-cell" colspan="4">Không thấy dữ liệu... {{input.value}}</td>
      </tr>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>
    <div class="float-left mt-4">
      <ng-content select="[tableFooter]"></ng-content>
    </div>
    <mat-paginator [pageSizeOptions]="[5, 10, 20, 50]"
                   showFirstLastButtons>
    </mat-paginator>

  </nb-card-body>
</nb-card>


<ng-template #string let-column="column" let-element="element">
    {{element[column.name]}}
</ng-template>

<ng-template #avatarString let-column="column" let-element="element">
  <img class="thumbnail-small" [src]="element['profileImageUrl']" [alt]="element[column.name]">
  {{element[column.name]}}
</ng-template>

<ng-template #boldString let-column="column" let-element="element">
  <b>{{element[column.name]}}</b>
</ng-template>

<ng-template #avatar let-column="column" let-element="element">
  <img class="thumbnail-small" [src]="element[column.name]" [alt]="element[column.name]">
</ng-template>

<ng-template #boldStringRole let-column="column" let-element="element">
  <b class="pr-1">{{element[column.name]}}</b>
  <nb-icon class="role-icon" status="{{icon.status}}" *ngFor="let icon of getRoleIcons(element['roles'])" icon="{{icon.icon}}" pack="fa"></nb-icon>
</ng-template>
